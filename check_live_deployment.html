<!DOCTYPE html>
<html>
<head>
    <title>üîç Live Deployment Check</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .status { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üîç OnlyPans Live Deployment Check</h1>
    
    <div class="status info">
        <strong>What this test does:</strong>
        <ul>
            <li>Checks what API URL your live Vercel app is actually using</li>
            <li>Tests if it can connect to the backend</li>
            <li>Shows you exactly what error occurs</li>
        </ul>
    </div>
    
    <button onclick="checkDeployment()">üîç Check Live Deployment</button>
    <button onclick="clearCache()">üßπ Clear Cache & Reload</button>
    
    <div id="results"></div>
    
    <script>
        async function checkDeployment() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="status info">Checking deployment...</div>';
            
            try {
                // First, let's see what's in your live app's console
                resultsDiv.innerHTML += `
                    <div class="status warning">
                        <h3>‚ö†Ô∏è Check Your Browser Console</h3>
                        <p>1. Open your Vercel app: <a href="https://onlypans-frontend.vercel.app" target="_blank">https://onlypans-frontend.vercel.app</a></p>
                        <p>2. Press F12 to open developer tools</p>
                        <p>3. Go to the Console tab</p>
                        <p>4. Look for lines that start with "üîß"</p>
                        <p>5. Tell me what API URL is being logged</p>
                    </div>
                `;
                
                // Test if the backend is working
                const backendResponse = await fetch('https://onlypans.onrender.com/api/ai/status/');
                const backendData = await backendResponse.json();
                
                if (backendData.available) {
                    resultsDiv.innerHTML += `
                        <div class="status success">
                            <h3>‚úÖ Backend is Working</h3>
                            <p>URL: https://onlypans.onrender.com/api</p>
                            <p>AI Service: Available</p>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML += `
                        <div class="status error">
                            <h3>‚ùå Backend Issue</h3>
                            <p>AI Service: Not Available</p>
                            <pre>${JSON.stringify(backendData, null, 2)}</pre>
                        </div>
                    `;
                }
                
                // Check CORS
                resultsDiv.innerHTML += `
                    <div class="status info">
                        <h3>üîß Manual Test Instructions</h3>
                        <p><strong>If you're still seeing localhost:8000 errors:</strong></p>
                        <ol>
                            <li>Go to your Vercel app</li>
                            <li>Open browser console (F12)</li>
                            <li>Type this command and press Enter:</li>
                        </ol>
                        <pre>console.log('API URL Test:', process?.env?.NEXT_PUBLIC_API_URL || 'not found')</pre>
                        <p><strong>Also try this in the console:</strong></p>
                        <pre>localStorage.clear(); location.reload();</pre>
                    </div>
                `;
                
                // Show what to look for
                resultsDiv.innerHTML += `
                    <div class="status warning">
                        <h3>üéØ What to Tell Me</h3>
                        <p>Please share with me:</p>
                        <ul>
                            <li>What does the browser console show for "üîß Final API URL"?</li>
                            <li>Are you still seeing "localhost:8000" in any error messages?</li>
                            <li>What exact error message do you see when trying the AI assistant?</li>
                            <li>Did clearing localStorage help?</li>
                        </ul>
                    </div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="status error">
                        <h3>‚ùå Test Error</h3>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        function clearCache() {
            alert(`
Please do this manually:

1. Press Ctrl+Shift+Delete
2. Select "All time"
3. Check all boxes
4. Click "Clear data"
5. Go to your Vercel app again

OR

1. Open your Vercel app
2. Press F12
3. In console, type: localStorage.clear(); location.reload();
            `);
        }
        
        // Auto-run check on page load
        checkDeployment();
    </script>
</body>
</html>
